# üìä AUDITOR√çA COMPLETA DE DATOS INTRAD√çA - POLYGON API

**Fecha**: 2025-10-21
**Universo**: 3,107 tickers (XNAS/XNYS, market cap < $2B)
**Per√≠odo**: 2004-01-01 ‚Üí 2025-10-21 (3 ventanas)
**Estado**: FALLO CATASTR√ìFICO (93.9% de datos faltantes)

---

## üöÄ C√ìMO REPRODUCIR ESTA AUDITOR√çA (COMANDOS EXACTOS)

### **OPCI√ìN 1: Ejecuci√≥n R√°pida (Recomendada)**

Si ya tienes los scripts de auditor√≠a, ejecuta directamente:

```bash
# Paso 1: Auditar completitud de datos
python tools/audit_intraday_completeness.py \
  --universe processed/universe/cs_xnas_xnys_under2b_2025-10-21.csv \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --windows 2004-01-01:2010-12-31,2011-01-01:2016-12-31,2017-01-01:2025-10-21 \
  --outdir audit_reports/intraday_1m_2025-10-21

# Paso 2: Analizar tickers 100% completos
python tools/analyze_complete_tickers.py \
  --coverage-json audit_reports/intraday_1m_2025-10-21/window_coverage.json \
  --metadata-json audit_reports/intraday_1m_2025-10-21/ticker_metadata.json \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --outdir audit_reports/complete_tickers_analysis
```

**Duraci√≥n**: ~20-30 segundos total

**Resultados**:
- `audit_reports/intraday_1m_2025-10-21/` ‚Üí Reportes de completitud
- `audit_reports/complete_tickers_analysis/` ‚Üí An√°lisis de tickers 100%

---

### **OPCI√ìN 2: Verificaci√≥n Manual (Sin scripts)**

Si no tienes los scripts o quieres verificar manualmente:

```bash
# 1. Contar archivos descargados
find raw/polygon/ohlcv_intraday_1m -type f -name "minute.parquet" | wc -l

# 2. Contar carpetas de tickers
ls -d raw/polygon/ohlcv_intraday_1m/*/ 2>/dev/null | wc -l

# 3. Verificar universo esperado
wc -l processed/universe/cs_xnas_xnys_under2b_2025-10-21.csv

# 4. Ver ejemplo de datos de un ticker
ls -lR raw/polygon/ohlcv_intraday_1m/AAPL/ 2>/dev/null || echo "AAPL no descargado"

# 5. Leer archivo parquet de ejemplo (con Python)
python -c "
import polars as pl
from pathlib import Path
# Buscar primer archivo parquet
p = next(Path('raw/polygon/ohlcv_intraday_1m').rglob('minute.parquet'), None)
if p:
    df = pl.read_parquet(p)
    print(f'Archivo: {p}')
    print(f'Rows: {df.height}')
    print(f'Columnas: {df.columns}')
    print(df.head())
else:
    print('No se encontraron archivos parquet')
"
```

---

## üìÇ ARCHIVOS Y SCRIPTS PARA REPRODUCIR ESTE ESTUDIO

### **Scripts de Auditor√≠a Creados**

#### 1. **`tools/audit_intraday_completeness.py`**
Script principal para auditar la completitud de datos descargados.

**Ubicaci√≥n**: `D:\04_TRADING_SMALLCAPS\tools\audit_intraday_completeness.py`

**Qu√© hace**:
- Compara tickers descargados vs universo esperado
- Calcula cobertura temporal por ventana
- Detecta archivos corruptos y vac√≠os
- Genera reportes detallados de completitud
- Identifica gaps en los datos

**Uso**:
```bash
python tools/audit_intraday_completeness.py \
  --universe processed/universe/cs_xnas_xnys_under2b_2025-10-21.csv \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --windows 2004-01-01:2010-12-31,2011-01-01:2016-12-31,2017-01-01:2025-10-21 \
  --outdir audit_reports/intraday_1m_2025-10-21
```

**Salidas generadas**:
- `missing_tickers.txt` - Lista de tickers sin datos
- `downloaded_tickers.txt` - Lista de tickers con datos
- `completeness_summary.csv` - Resumen completo por ticker
- `window_coverage.json` - Cobertura detallada por ventana
- `ticker_metadata.json` - Metadatos completos
- `download_priority.csv` - Prioridades de descarga

---

#### 2. **`tools/analyze_complete_tickers.py`**
Script para an√°lisis profundo de tickers con 100% de cobertura.

**Ubicaci√≥n**: `D:\04_TRADING_SMALLCAPS\tools\analyze_complete_tickers.py`

**Qu√© hace**:
- Identifica tickers con cobertura 100% en cada ventana
- An√°lisis de calidad de datos (gaps, duplicados, continuidad)
- Estad√≠sticas de trading (volumen, trades, minutos/d√≠a)
- Comparaci√≥n de tickers completos vs parciales

**Uso**:
```bash
python tools/analyze_complete_tickers.py \
  --coverage-json audit_reports/intraday_1m_2025-10-21/window_coverage.json \
  --metadata-json audit_reports/intraday_1m_2025-10-21/ticker_metadata.json \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --outdir audit_reports/complete_tickers_analysis
```

**Salidas generadas**:
- `complete_ALL_windows.txt` - Tickers completos en todas las ventanas
- `complete_TWO_windows.txt` - Tickers completos en 2 ventanas
- `complete_100pct_[ventana].txt` - Tickers completos por ventana
- `complete_tickers_summary.csv` - Resumen con m√©tricas de calidad
- `quality_analysis.json` - An√°lisis detallado de calidad
- `completeness_breakdown.txt` - Desglose completo por ticker

---

### **Proceso Completo para Reproducir el Estudio**

#### **Paso 1: Ejecutar auditor√≠a de completitud**

```bash
cd D:\04_TRADING_SMALLCAPS

python tools/audit_intraday_completeness.py \
  --universe processed/universe/cs_xnas_xnys_under2b_2025-10-21.csv \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --windows 2004-01-01:2010-12-31,2011-01-01:2016-12-31,2017-01-01:2025-10-21 \
  --outdir audit_reports/intraday_1m_2025-10-21
```

**Duraci√≥n aproximada**: 10-20 segundos

---

#### **Paso 2: Analizar tickers 100% completos**

```bash
python tools/analyze_complete_tickers.py \
  --coverage-json audit_reports/intraday_1m_2025-10-21/window_coverage.json \
  --metadata-json audit_reports/intraday_1m_2025-10-21/ticker_metadata.json \
  --datadir raw/polygon/ohlcv_intraday_1m \
  --outdir audit_reports/complete_tickers_analysis
```

**Duraci√≥n aproximada**: 5-10 segundos

---

#### **Paso 3: Revisar reportes generados**

**Ubicaciones**:
```
audit_reports/
‚îú‚îÄ‚îÄ intraday_1m_2025-10-21/
‚îÇ   ‚îú‚îÄ‚îÄ completeness_summary.csv          ‚Üê Resumen general
‚îÇ   ‚îú‚îÄ‚îÄ window_coverage.json              ‚Üê Cobertura por ventana
‚îÇ   ‚îú‚îÄ‚îÄ missing_tickers.txt               ‚Üê 2,917 tickers faltantes
‚îÇ   ‚îú‚îÄ‚îÄ downloaded_tickers.txt            ‚Üê 190 tickers descargados
‚îÇ   ‚îú‚îÄ‚îÄ download_priority.csv             ‚Üê Prioridades
‚îÇ   ‚îî‚îÄ‚îÄ ticker_metadata.json              ‚Üê Metadatos detallados
‚îÇ
‚îî‚îÄ‚îÄ complete_tickers_analysis/
    ‚îú‚îÄ‚îÄ complete_tickers_summary.csv      ‚Üê M√©tricas de calidad
    ‚îú‚îÄ‚îÄ complete_ALL_windows.txt          ‚Üê 1 ticker (HIFS)
    ‚îú‚îÄ‚îÄ complete_TWO_windows.txt          ‚Üê 4 tickers
    ‚îú‚îÄ‚îÄ complete_100pct_*.txt             ‚Üê Por ventana
    ‚îú‚îÄ‚îÄ quality_analysis.json             ‚Üê An√°lisis detallado
    ‚îî‚îÄ‚îÄ completeness_breakdown.txt        ‚Üê Desglose completo
```

---

## üî¥ RESULTADOS DE LA AUDITOR√çA

### **RESUMEN GLOBAL**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    ESTADO GLOBAL                             ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Universo esperado:           3,107 tickers                   ‚ïë
‚ïë Tickers descargados:           190 tickers (6.1%) ‚úì         ‚ïë
‚ïë Tickers FALTANTES:           2,917 tickers (93.9%) ‚ùå        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Datos descargados:         5,077,348 rows                    ‚ïë
‚ïë Archivos parquet:              7,550 archivos                ‚ïë
‚ïë Archivos corruptos:                4 tickers ‚ö†Ô∏è              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**VEREDICTO**: üö® **FALLO CATASTR√ìFICO** - Solo 6.1% de datos descargados

---

### **COBERTURA POR VENTANA TEMPORAL**

#### **Ventana 1: 2004-01-01 ‚Üí 2010-12-31** (84 meses esperados)
```
De los 190 tickers descargados:
  ‚úì Cobertura 100%:      29 tickers (15.3%)
  ‚ö†Ô∏è Cobertura parcial:  124 tickers (65.3%)
  ‚ùå Sin datos:          37 tickers (19.5%)
```

#### **Ventana 2: 2011-01-01 ‚Üí 2016-12-31** (72 meses esperados)
```
De los 190 tickers descargados:
  ‚úì Cobertura 100%:      12 tickers (6.3%)
  ‚ö†Ô∏è Cobertura parcial:   22 tickers (11.6%)
  ‚ùå Sin datos:         156 tickers (82.1%) ‚Üê CR√çTICO
```

#### **Ventana 3: 2017-01-01 ‚Üí 2025-10-21** (106 meses esperados)
```
De los 190 tickers descargados:
  ‚úì Cobertura 100%:       2 tickers (1.1%) ‚Üê CATASTR√ìFICO
  ‚ö†Ô∏è Cobertura parcial:   15 tickers (7.9%)
  ‚ùå Sin datos:         173 tickers (91.1%) ‚Üê CR√çTICO
```

**CONCLUSI√ìN**: La descarga reciente (ventana 3) fue un **FALLO TOTAL**.

---

### **ARCHIVOS CORRUPTOS**

4 tickers con archivos parquet corruptos:

| Ticker | Rows | Archivos | Rango temporal | Estado |
|--------|------|----------|----------------|--------|
| **IPI** | 47,148 | 27 (1 corrupto) | 2004-2008 | ‚ö†Ô∏è Error lectura parquet |
| **LIND** | 19,116 | 10 (1 corrupto) | 2015-2016 | ‚ö†Ô∏è Error lectura parquet |
| **NCI** | 43,674 | 10 (1 corrupto) | 2004 | ‚ö†Ô∏è Error lectura parquet |
| **PETS** | 46,777 | 17 (1 corrupto) | 2004-2005 | ‚ö†Ô∏è Error lectura parquet |

---

## üèÜ AN√ÅLISIS DE TICKERS 100% COMPLETOS

### **DISTRIBUCI√ìN DE COMPLETITUD**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         TICKERS CON COBERTURA 100% (37 tickers totales)           ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë ‚úì Completos en TODAS las ventanas (3):           1 ticker         ‚ïë
‚ïë ‚ö†Ô∏è Completos en DOS ventanas:                     4 tickers        ‚ïë
‚ïë ‚ö†Ô∏è Completos en UNA ventana:                     32 tickers        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Total rows:                                  862,816               ‚ïë
‚ïë Promedio rows/ticker:                         23,319               ‚ïë
‚ïë Promedio d√≠as √∫nicos/ticker:                  1,734               ‚ïë
‚ïë Promedio minutos trading/d√≠a:                  12.7 ‚ö†Ô∏è             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

‚ö†Ô∏è **ALERTA**: Promedio 12.7 minutos/d√≠a es **MUY BAJO**
(D√≠a completo de trading = 390 minutos, 9:30-16:00)
‚Üí Estos son tickers **poco l√≠quidos** con actividad sparse

---

### **ü•á EL √öNICO CAMPE√ìN: HIFS**

**HIFS** es el **√öNICO ticker** con 100% de cobertura en las **3 ventanas**:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                         HIFS                                 ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Ventanas completas:    TODAS (2004-2010, 2011-2016, 2017-2025) ‚ïë
‚ïë Total rows:            43,815                                ‚ïë
‚ïë D√≠as √∫nicos:           4,426 d√≠as (12.1 a√±os de trading)    ‚ïë
‚ïë Rango temporal:        2004-01-05 ‚Üí 2025-10-21              ‚ïë
‚ïë Total trades:          668,085 trades                        ‚ïë
‚ïë Volumen total:         19,412,844                            ‚ïë
‚ïë Promedio mins/d√≠a:     9.9 minutos ‚ö†Ô∏è                         ‚ïë
‚ïë Gaps detectados:       41 gaps (>7 d√≠as) ‚ö†Ô∏è                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚ö†Ô∏è  PROBLEMAS:
  ‚Ä¢ Solo 9.9 minutos/d√≠a ‚Üí Ticker poco l√≠quido
  ‚Ä¢ 41 gaps grandes ‚Üí Per√≠odos sin trading

‚úÖ  FORTALEZAS:
  ‚Ä¢ √önico con cobertura completa 2004-2025
  ‚Ä¢ 668,085 trades totales ‚Üí Actividad consistente a largo plazo
```

---

### **ü•à TOP 4 TICKERS: 2 VENTANAS COMPLETAS**

#### **1. UBFO** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (El m√°s consistente)
```
Ventanas:     2004-2010, 2011-2016
Rows:         58,588 (2do m√°s alto)
D√≠as:         3,143
Trades:       146,217
Mins/d√≠a:     18.6 (mejor que promedio)
Gaps:         0 ‚úÖ (PERFECTO - sin gaps)
Volumen:      38,656,181
Precio rango: $10.50 - $35.20
```
**Veredicto**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê El mejor ticker en t√©rminos de consistencia

---

#### **2. PDEX** ‚≠ê‚≠ê‚≠ê‚≠ê
```
Ventanas:     2004-2010, 2011-2016
Rows:         44,105
D√≠as:         3,131
Trades:       150,042 (m√°s que UBFO)
Mins/d√≠a:     14.1
Gaps:         1 (casi perfecto)
Volumen:      44,557,815
```
**Veredicto**: Excelente, muy similar a UBFO

---

#### **3. NATH** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (El de m√°s datos)
```
Ventanas:     2004-2010, 2017-2025 (skip 2011-2016) ü§î
Rows:         70,083 ‚Üê M√ÅS ALTO DE TODOS
D√≠as:         3,941 (10.8 a√±os)
Trades:       487,949 ‚Üê 2do M√ÅS ALTO
Mins/d√≠a:     17.8
Gaps:         1 (casi perfecto)
Volumen:      36,185,951
```
**Veredicto**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê M√°s volumen de datos, excelente calidad
**Pregunta abierta**: ¬øPor qu√© tiene ventanas 1 y 3 pero no la 2?

---

#### **4. GCBC** ‚≠ê‚≠ê
```
Ventanas:     2004-2010, 2011-2016
Rows:         8,590 (bajo)
D√≠as:         2,068
Trades:       18,991
Mins/d√≠a:     4.2 ‚ö†Ô∏è (muy bajo)
Gaps:         39 ‚ö†Ô∏è (muchos gaps)
Volumen:      11,420,512
```
**Veredicto**: Cobertura 100% pero calidad baja

---

### **üìà TOP 10 TICKERS POR VOLUMEN DE DATOS**

| Rank | Ticker | Windows | Rows | D√≠as | Mins/d√≠a | Trades | Gaps | Calidad |
|------|--------|---------|------|------|----------|--------|------|---------|
| 1 | **NATH** | 2 | 70,083 | 3,941 | 17.8 | 487,949 | 1 | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| 2 | **UBFO** | 2 | 58,588 | 3,143 | 18.6 | 146,217 | 0 | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| 3 | **UMH** | 1 | 50,000 | 1,746 | 28.6 | 101,894 | 0 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 4 | **LAKE** | 1 | 45,824 | 1,753 | 26.1 | 113,749 | 0 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 5 | **PDEX** | 2 | 44,105 | 3,131 | 14.1 | 150,042 | 1 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 6 | **HIFS** | 3 | 43,815 | 4,426 | 9.9 | 668,085 | 41 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 7 | **CTO** | 1 | 42,701 | 1,509 | 28.3 | 127,974 | 0 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 8 | **HTB** | 1 | 36,197 | 1,760 | 20.6 | 77,749 | 0 | ‚≠ê‚≠ê‚≠ê‚≠ê |
| 9 | **VLGEA** | 1 | 34,632 | 1,615 | 21.4 | 68,238 | 2 | ‚≠ê‚≠ê‚≠ê |
| 10 | **WLFC** | 1 | 34,180 | 1,700 | 20.1 | 82,903 | 1 | ‚≠ê‚≠ê‚≠ê‚≠ê |

---

### **üìâ TICKERS CON M√ÅS PROBLEMAS**

#### **PBHC** - El peor de todos ‚≠ê
```
Rows:         1,581 (m√≠nimo absoluto)
D√≠as:         656 (menos de 2 a√±os de 7 esperados)
Mins/d√≠a:     2.4 ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è (EXTREMADAMENTE BAJO)
Gaps:         81 ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è (M√ÅS GAPS DE TODOS)
Trades:       2,682
Volumen:      899,813
```
**Problema**: Aunque clasificado como "100% cobertura" en ventana 2004-2010, los datos son **extremadamente sparse** e in√∫tiles para an√°lisis serio.

---

#### **DJCO** - 78 gaps ‚≠ê
```
Rows:         2,413
D√≠as:         701 (menos de 2 a√±os)
Mins/d√≠a:     3.4 ‚ö†Ô∏è‚ö†Ô∏è
Gaps:         78 ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
```
**Problema**: Datos extremadamente fragmentados

---

#### **FCAP** - 66 gaps ‚≠ê‚≠ê
```
Rows:         5,595
D√≠as:         1,751
Mins/d√≠a:     3.2 ‚ö†Ô∏è‚ö†Ô∏è
Gaps:         66 ‚ö†Ô∏è‚ö†Ô∏è
```

---

### **üîç AN√ÅLISIS DE LIQUIDEZ**

**Distribuci√≥n de minutos promedio por d√≠a**:

```
D√≠a completo de trading: ~390 minutos (9:30-16:00 EST)
Promedio de estos 37 tickers: 12.7 minutos (3.3% del d√≠a)

Distribuci√≥n:
  < 5 minutos/d√≠a:    6 tickers (16.2%) ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è Muy baja liquidez
  5-10 minutos/d√≠a:   9 tickers (24.3%) ‚ö†Ô∏è‚ö†Ô∏è  Baja liquidez
  10-20 minutos/d√≠a: 15 tickers (40.5%) ‚ö†Ô∏è   Liquidez moderada
  20-30 minutos/d√≠a:  7 tickers (18.9%) ‚úì    Liquidez aceptable
  > 30 minutos/d√≠a:   0 tickers (0%)
```

**Conclusi√≥n**: Todos estos tickers son **small caps poco l√≠quidos** con trading muy sparse. Esto es **normal** para empresas <$2B market cap, pero debe considerarse en cualquier an√°lisis cuantitativo.

---

### **‚ö†Ô∏è AN√ÅLISIS DE GAPS**

**22 de 37 tickers** (59.5%) tienen gaps grandes (>7 d√≠as sin trading):

**Top 10 tickers con m√°s gaps**:
1. PBHC: 81 gaps
2. DJCO: 78 gaps
3. FCAP: 66 gaps
4. HIFS: 41 gaps (¬°incluso el campe√≥n tiene gaps!)
5. GCBC: 39 gaps
6. AUBN: 23 gaps
7. NWFL: 22 gaps
8. TAIT: 20 gaps
9. ISRL: 12 gaps
10. RAND: 9 gaps

**15 tickers SIN gaps** (40.5%) ‚úÖ:
- UBFO, EML, FLXS, HFWA, HTB, JBI, LAKE, MLP, MTEX, NRIM, SAR, STRT, UMH, ACNB, CTO

---

### **‚úÖ CALIDAD DE DATOS**

**Duplicados detectados**: **0** ‚úÖ
‚Üí Ning√∫n ticker tiene filas duplicadas (campo `minute`)

**Integridad de archivos**: **97.3%** ‚úÖ
‚Üí Solo 4 de 912 carpetas tienen archivos corruptos

**Consistencia de estructura**: **100%** ‚úÖ
‚Üí Todos los archivos siguen estructura `ticker/year=/month=/minute.parquet`

---

## üíé RECOMENDACIONES DE USO

### **Tickers PREMIUM (5 estrellas) - Usar con confianza m√°xima**
```
1. UBFO  - 0 gaps, 2 ventanas, consistencia perfecta
2. NATH  - M√°s datos, alta calidad, 2 ventanas, solo 1 gap
3. PDEX  - Casi perfecto, 2 ventanas, solo 1 gap
4. LAKE  - Sin gaps, buenos datos, densidad alta
5. UMH   - Sin gaps, alta densidad (28.6 mins/d√≠a)
```

### **Tickers BUENOS (4 estrellas) - Usar con precauci√≥n leve**
```
- HIFS   - El campe√≥n (3 ventanas) pero con 41 gaps
- CTO    - Sin gaps, buena densidad (28.3 mins/d√≠a)
- HTB    - Sin gaps, buena consistencia
- EML    - Sin gaps, datos s√≥lidos
- HFWA   - Sin gaps
- FLXS   - Sin gaps
- WLFC   - 1 gap m√≠nimo
- VLGEA  - 2 gaps
- STRT   - Sin gaps
```

### **Tickers REGULARES (3 estrellas o menos) - Usar solo si necesario**
```
- GCBC   - 39 gaps, baja densidad (4.2 mins/d√≠a)
- DJCO   - 78 gaps, muy fragmentado
- PBHC   - 81 gaps, extremadamente sparse
- FCAP   - 66 gaps
- AUBN   - 23 gaps
```

---

## üî¥ PROBLEMAS CR√çTICOS EN EL C√ìDIGO DE DESCARGA

### **Problema #1: PAR√ÅMETRO `--max-workers` IGNORADO**

**Archivo**: `ingest_ohlcv_intraday_minute.py:179`

```python
ap.add_argument("--max-workers", type=int, default=1,
                help="(IGNORADO) Paralelismo lo maneja el launcher.")
```

**Pero el launcher S√ç lo pasa** (`launch_intraday_windows.py:191`):
```python
"--max-workers", str(args.per_shard_workers),  # ‚Üê COMPLETAMENTE IGNORADO
```

**Impacto**: Usuario cree controlar paralelismo, pero el par√°metro **no hace nada**.

---

### **Problema #2: EXIT TEMPRANO SIN RELANZAMIENTO**

**Archivo**: `ingest_ohlcv_intraday_minute.py:214-216`

```python
if args.max_tickers_per_process and processed >= args.max_tickers_per_process:
    log(f"Alcanzado --max-tickers-per-process={args.max_tickers_per_process}. Saliendo...")
    break  # ‚Üê SALE SIN COMPLETAR EL SHARD
```

**Evidencia real**:
- Shard 00: 259 tickers asignados ‚Üí **13 procesados** (5%)
- Default: `--max-tickers-per-process=30`
- Launcher **NO pasa** este par√°metro ‚Üí usa default
- **Resultado**: 246 tickers perdidos por shard

**Impacto**: Tickers no procesados **se pierden para siempre**.

---

### **Problema #3: LOGGING ENGA√ëOSO**

**Archivo**: `ingest_ohlcv_intraday_minute.py:221-222`

```python
ok = sum("ERROR" not in r for r in results)
err = len(results) - ok
```

**Problema**: Tickers con **0 rows** se marcan como "OK":
```
[2025-10-21 13:52:46] IZEA: 0 rows (1 pages) [1m]  ‚Üê Marcado como OK ‚úÖ
```

**No distingue**:
- ‚úÖ Descarga leg√≠tima sin datos (ticker no exist√≠a en ese per√≠odo)
- ‚ùå Ticker no existe en Polygon
- ‚ùå Rate limit silencioso
- ‚ùå Error de API no reportado

---

### **Problema #4: RESUMPTION LOGIC ROTA**

**Archivo**: `launch_intraday_windows.py:60-64`

```python
def existing_tickers(outdir: Path) -> set[str]:
    """Resume simple: si existe carpeta del ticker, lo consideramos 'ya iniciado'."""
    return {p.name for p in outdir.iterdir() if p.is_dir()}
```

**Problemas**:
1. **NO verifica ventanas**: Si AAPL tiene datos de 2020, skip TODAS las ventanas
2. **NO verifica completitud**: Carpeta vac√≠a = "completado"
3. **NO verifica errores**: Ticker con errores = "completado"

**Impacto**: Con `--resume`, **NUNCA** se completan datos faltantes.

**Evidencia**: 82-91% de tickers sin datos en ventanas 2 y 3.

---

### **Problema #5: CURSOR PARSING SILENCIOSO**

**Archivo**: `ingest_ohlcv_intraday_minute.py:45-54`

```python
def parse_next_cursor(next_url: Optional[str]) -> Optional[str]:
    try:
        # ... parsing ...
        return cur[0] if cur else None
    except Exception:
        return None  # ‚Üê SILENCIOSO: paginaci√≥n SE DETIENE
```

**Impacto**: Si falla parsear cursor ‚Üí descarga **incompleta** sin error reportado.

---

### **Problema #6: RATE LIMIT SALTADO EN √öLTIMA P√ÅGINA**

**Archivo**: `ingest_ohlcv_intraday_minute.py:162-165`

```python
if not cursor:
    break  # ‚Üê SALE INMEDIATAMENTE
if rate_limit_s and rate_limit_s > 0:
    time.sleep(rate_limit_s)  # ‚Üê NUNCA SE EJECUTA
```

**Impacto**: √öltima p√°gina **NO espera** rate limit ‚Üí triggerea 429 en siguiente ticker.

---

### **Problema #7: ERRORES TLS/SSL EN WINDOWS**

**Evidencia de logs** (`2004-01-01_2010-12-31_worker_00.log`):
```
GET error HTTPSConnectionPool: Max retries exceeded (SSLError)
GET error Could not find a suitable TLS CA certificate bundle
GET error Unable to allocate output buffer
```

**Frecuencia**: Cientos de errores
**Impacto**: Workers crashean despu√©s de 8 reintentos fallidos

---

### **Problema #8: LOGGING SIN LOCKS - RACE CONDITIONS**

**Archivo**: `ingest_ohlcv_intraday_minute.py:224-226`

```python
log_file = outdir / "minute_download.log"
with open(log_file, "a", encoding="utf-8") as f:  # ‚Üê APPEND sin lock
    f.write("\n".join(results) + "\n")
```

**Problema**: 36 procesos escribiendo simult√°neamente al mismo archivo sin locks.

**Consecuencia**: L√≠neas mezcladas, datos corruptos, p√©rdida de logs.

---

## üéØ CONCLUSIONES Y HALLAZGOS CLAVE

### ‚úÖ **Hallazgos Positivos**

1. **1 ticker (HIFS)** tiene datos completos 2004-2025 ‚úÖ
2. **4 tickers adicionales** tienen 2 ventanas completas ‚úÖ
3. **0 duplicados** detectados en ning√∫n ticker ‚úÖ
4. **15 tickers sin gaps** ‚Üí excelente calidad ‚úÖ
5. **Estructura de archivos consistente** ‚Üí f√°cil de procesar ‚úÖ

---

### ‚ö†Ô∏è **Problemas Detectados**

1. **93.9% de datos faltantes** ‚Üí descarga casi completamente fallida ‚ùå
2. **Todos los tickers son poco l√≠quidos** (12.7 mins/d√≠a promedio vs 390) ‚ö†Ô∏è
3. **59% tienen gaps grandes** en sus datos ‚ö†Ô∏è
4. **Solo 2 tickers completos** en ventana reciente (2017-2025) ‚ùå
5. **M√∫ltiples bugs en c√≥digo** de descarga que causaron el fallo ‚ùå

---

### üö® **Implicaci√≥n Cr√≠tica**

La **"cobertura 100%"** significa:
- ‚úÖ Tiene **AL MENOS 1 minuto** de datos en cada mes esperado
- ‚ùå **NO** significa trading diario completo
- ‚ùå **NO** significa alta liquidez

Para small caps il√≠quidos (<$2B), esto es **normal** pero debe considerarse:
- Backtesting requerir√° consideraciones especiales de liquidez
- Modelos cuantitativos necesitar√°n ajustes por sparse data
- An√°lisis de volatilidad puede estar sesgado por gaps

---

### üìä **Estad√≠sticas Finales**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                  RESUMEN FINAL                               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Universo:                    3,107 tickers                   ‚ïë
‚ïë Descargados (cualquier dato):  190 tickers (6.1%)           ‚ïë
‚ïë Faltantes:                    2,917 tickers (93.9%)          ‚ïë
‚ïë                                                              ‚ïë
‚ïë Completos en 3 ventanas:          1 ticker (HIFS)           ‚ïë
‚ïë Completos en 2 ventanas:          4 tickers                 ‚ïë
‚ïë Completos en 1 ventana:          32 tickers                 ‚ïë
‚ïë                                                              ‚ïë
‚ïë Total rows descargadas:       5,077,348                      ‚ïë
‚ïë Archivos parquet:                 7,550                      ‚ïë
‚ïë Tickers con archivos corruptos:      4                      ‚ïë
‚ïë                                                              ‚ïë
‚ïë Calidad promedio:             ‚≠ê‚≠ê‚≠ê (3/5 estrellas)          ‚ïë
‚ïë Estado del sistema:           üö® FALLO CR√çTICO               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üöÄ ACCIONES RECOMENDADAS

### **URGENTE (antes de relanzar descarga)**

1. ‚úÖ **Fijar TLS/SSL en Windows**
   - Instalar certificados correctos
   - Configurar `SSL_CERT_FILE` si necesario

2. ‚úÖ **Pasar `--max-tickers-per-process=0`** en launcher
   - O implementar relanzamiento autom√°tico de procesos

3. ‚úÖ **Fijar resumption logic**
   - Verificar ventanas espec√≠ficas
   - Validar completitud de datos
   - No solo verificar existencia de carpeta

4. ‚úÖ **Fijar rate limit**
   - Aplicar sleep **antes** de break

---

### **IMPORTANTE (mejorar calidad)**

5. ‚ö†Ô∏è **Separar logs por worker**
   - Evitar race conditions
   - Logs del tipo `worker_00.log`, `worker_01.log`

6. ‚ö†Ô∏è **Distinguir 0 rows leg√≠timo vs error**
   - Verificar status code de API
   - Reportar diferencia en logs

7. ‚ö†Ô∏è **Cursor parsing con logging**
   - No silenciar errores
   - Reportar cuando falla parsing

8. ‚ö†Ô∏è **Validaci√≥n post-descarga**
   - Verificar archivos no vac√≠os
   - Validar integridad de parquet

---

### **OPCIONAL (optimizaci√≥n)**

9. üìä **Deduplicaci√≥n por timestamp**
   - Usar `t` (epoch) en vez de `minute` (string)

10. üìä **Checkpoints m√°s frecuentes**
    - Cada 10 tickers en vez de 25

11. üìä **M√©tricas de health**
    - Monitor de progreso en tiempo real
    - Dashboard de workers activos

---

## üìÅ ESTRUCTURA DE REPORTES GENERADOS

```
D:\04_TRADING_SMALLCAPS\
‚îú‚îÄ‚îÄ audit_reports/
‚îÇ   ‚îú‚îÄ‚îÄ intraday_1m_2025-10-21/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ completeness_summary.csv          ‚Üê Resumen por ticker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ window_coverage.json              ‚Üê Cobertura detallada
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ missing_tickers.txt               ‚Üê 2,917 faltantes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ downloaded_tickers.txt            ‚Üê 190 descargados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ download_priority.csv             ‚Üê Prioridades
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ticker_metadata.json              ‚Üê Metadatos
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ complete_tickers_analysis/
‚îÇ       ‚îú‚îÄ‚îÄ complete_tickers_summary.csv      ‚Üê M√©tricas calidad
‚îÇ       ‚îú‚îÄ‚îÄ complete_ALL_windows.txt          ‚Üê 1: HIFS
‚îÇ       ‚îú‚îÄ‚îÄ complete_TWO_windows.txt          ‚Üê 4: UBFO, PDEX, NATH, GCBC
‚îÇ       ‚îú‚îÄ‚îÄ complete_100pct_2004-01-01_2010-12-31.txt   ‚Üê 29 tickers
‚îÇ       ‚îú‚îÄ‚îÄ complete_100pct_2011-01-01_2016-12-31.txt   ‚Üê 12 tickers
‚îÇ       ‚îú‚îÄ‚îÄ complete_100pct_2017-01-01_2025-10-21.txt   ‚Üê 2 tickers
‚îÇ       ‚îú‚îÄ‚îÄ quality_analysis.json             ‚Üê An√°lisis detallado
‚îÇ       ‚îî‚îÄ‚îÄ completeness_breakdown.txt        ‚Üê Desglose completo
‚îÇ
‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îú‚îÄ‚îÄ audit_intraday_completeness.py        ‚Üê Script auditor√≠a
‚îÇ   ‚îî‚îÄ‚îÄ analyze_complete_tickers.py           ‚Üê Script an√°lisis
‚îÇ
‚îî‚îÄ‚îÄ AUDITORIA_DATOS_INTRADAY.md              ‚Üê Este documento
```

---

## üìñ REFERENCIAS DE C√ìDIGO

### **Scripts de descarga originales (con bugs)**
- `scripts/fase_1_Bloque_B/ingest_ohlcv_intraday_minute.py`
- `scripts/fase_1_Bloque_B/tools/launch_intraday_windows.py`

### **Logs de ejecuci√≥n**
- `runs/intraday_1m_windows_2025-10-21/logs/`
- `raw/polygon/ohlcv_intraday_1m/minute_download.log`

### **Datos descargados**
- `raw/polygon/ohlcv_intraday_1m/[TICKER]/year=[YYYY]/month=[MM]/minute.parquet`

---

## üîó ENLACES √öTILES

- **Polygon API Docs**: https://polygon.io/docs/stocks/get_v2_aggs_ticker__stocksticker__range__multiplier___timespan___from___to
- **Polars Docs**: https://pola-rs.github.io/polars/
- **Parquet Format**: https://parquet.apache.org/

---

**Documento generado**: 2025-10-21
**Versi√≥n**: 1.0
**Autor**: Auditor√≠a automatizada de datos intrad√≠a
