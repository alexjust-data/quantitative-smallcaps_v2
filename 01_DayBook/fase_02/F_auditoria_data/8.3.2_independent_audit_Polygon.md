**Cómo usar la auditoría independiente** paso a paso:

---

# INDEPENDENT DATA AUDIT — INSTRUCCIONES CLARAS

**Carpeta de auditoría independiente:**
👉 [independent_audit/](independent_audit/)

---

## 📁 CONTENIDO DEL PAQUETE

```
independent_audit/
├── verify_against_reference.py
├── make_report_md.py
├── requirements.txt
├── README.md
├── run_example.ps1
├── vendors/
│   └── polygon_client.py
├── utils/
│   └── compare_minute.py
└── reports/
```

**Función de cada parte:**

| Archivo                       | Descripción                                                                           |
| ----------------------------- | ------------------------------------------------------------------------------------- |
| `verify_against_reference.py` | Descarga datos externos (ej. Polygon) y compara con tus barras (minute o DIB→minute). |
| `vendors/polygon_client.py`   | Cliente de API para obtener datos de Polygon.io.                                      |
| `utils/compare_minute.py`     | Calcula diferencias relativas y match-rate entre ambos datasets.                      |
| `make_report_md.py`           | Genera un informe `.md` legible con los resultados.                                   |
| `requirements.txt`            | Dependencias necesarias.                                                              |
| `run_example.ps1`             | Script de ejemplo para PowerShell (Windows).                                          |

---

## ⚙️ INSTALACIÓN

1. Crea un entorno virtual y activa:

   ```bash
   python -m venv .venv
   . .venv/bin/activate      # En Windows: .venv\Scripts\activate
   ```

2. Instala dependencias:

   ```bash
   pip install -r requirements.txt
   ```

---

## 🔑 CONFIGURAR CLAVE DE POLYGON

* **Mac / Linux:**

  ```bash
  export POLYGON_API_KEY=TU_API_KEY
  ```
* **Windows PowerShell:**

  ```powershell
  $env:POLYGON_API_KEY="TU_API_KEY"
  ```

---

## ▶️ CÓMO EJECUTAR LA AUDITORÍA

### OPCIÓN 1 — Comparar tus **minute bars**

```bash
python verify_against_reference.py \
  --symbols AMC,AAPL \
  --dates 2024-05-17 \
  --vendor polygon \
  --our-minute-root "D:/04_TRADING_SMALLCAPS/processed/minute" \
  --out reports/report_polygon_minute.json
```

---

### OPCIÓN 2 — Comparar tus **Dollar Imbalance Bars** (agregadas a minuto)

```bash
python verify_against_reference.py \
  --symbols AMC \
  --dates 2024-05-17 \
  --vendor polygon \
  --our-dib-root "D:/04_TRADING_SMALLCAPS/processed/bars" \
  --out reports/report_polygon_from_dib.json
```

---

## 🧾 GENERAR INFORME MARKDOWN

```bash
python make_report_md.py \
  --input reports/report_polygon_minute.json \
  --output reports/INDEPENDENT_DATA_REPORT.md \
  --title "Independent Verification vs Polygon (Minute)"
```

El informe se guardará en:
`reports/INDEPENDENT_DATA_REPORT.md`

---

## 📊 QUÉ VERIFICA

* Alinea ambos datasets por **minuto (UTC)**.
* Calcula diferencias relativas:

  * Precio (máximo entre Δopen, Δhigh, Δlow, Δclose)
  * Volumen
* Evalúa si cada barra pasa el test:

  * Precio ≤ **0.2 %**
  * Volumen ≤ **5 %**

Produce:

* `match_rate` global (porcentaje de coincidencias)
* Estadísticas medias y percentil 95
* Lista de discrepancias ("breaks") para inspección manual

---

## 🔍 RESULTADO EJEMPLO

```
Wrote report: reports/report_polygon_minute.json
Overall match rate: 0.9856
```

Luego ejecutas `make_report_md.py` para crear un Markdown legible.

---

## ⚖️ QUÉ SIGNIFICA

| Resultado           | Interpretación                                                       |
| ------------------- | -------------------------------------------------------------------- |
| `match_rate ≥ 0.95` | Dataset validado — coincide estadísticamente con datos de referencia |
| `match_rate < 0.95` | Revisar diferencias (pueden deberse a filtros del feed o horarios)   |

---

## 🧠 NOTAS IMPORTANTES

* Tiempos manejados en **UTC**.
* Pequeñas diferencias son normales (por redondeo o filtros de *odd lots*).
* El proceso **no depende** de tu suite anterior: es una **verificación independiente**.
* Puedes extender el sistema para otros vendors (IEX, Tiingo, WRDS-TAQ).

---

